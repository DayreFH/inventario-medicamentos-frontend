generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  password   String
  name       String
  isActive   Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  roleId     Int?
  roles      roles?   @relation(fields: [roleId], references: [id])

  @@index([email])
  @@index([roleId], map: "users_roleId_fkey")
  @@map("users")
}

model Medicine {
  id                Int               @id @default(autoincrement())
  codigo            String            @unique
  nombreComercial   String
  nombreGenerico    String
  formaFarmaceutica FormaFarmaceutica @default(comprimidos)
  concentracion     Concentracion     @default(mg)
  presentacion      Presentacion      @default(blister)
  fechaVencimiento  DateTime?
  pesoKg            Decimal           @default(0.000) @db.Decimal(10, 3)
  stock             Int               @default(0)
  created_at        DateTime          @default(now())
  updated_at        DateTime          @updatedAt
  parametros        MedicineParam?
  precios           MedicinePrice[]
  receiptitem       receiptitem[]
  saleitem          saleitem[]

  @@index([nombreComercial])
  @@index([fechaVencimiento])
  @@index([stock])
  @@map("medicines")
}

model MedicinePrice {
  id                    Int       @id @default(autoincrement())
  medicineId            Int
  precioCompraUnitario  Decimal   @db.Decimal(10, 2)
  margenUtilidad        Decimal   @db.Decimal(5, 2)
  precioVentaUnitario   Decimal   @db.Decimal(10, 2)
  precioLimiteDescuento Decimal?  @db.Decimal(10, 2)
  activo                Boolean   @default(true)
  created_at            DateTime  @default(now())
  updated_at            DateTime  @updatedAt
  supplierId            Int?
  medicine              Medicine  @relation(fields: [medicineId], references: [id], onDelete: Cascade)
  supplier              supplier? @relation(fields: [supplierId], references: [id])

  @@index([medicineId], map: "medicine_prices_medicineId_fkey")
  @@index([supplierId], map: "medicine_prices_supplierId_fkey")
  @@map("medicine_prices")
}

model MedicineParam {
  id                  Int      @id @default(autoincrement())
  medicineId          Int      @unique
  stockMinimo         Int      @default(10)
  alertaCaducidad     Int      @default(30)
  tiempoSinMovimiento Int      @default(90)
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt
  medicine            Medicine @relation(fields: [medicineId], references: [id], onDelete: Cascade)

  @@map("medicine_params")
}

model ExchangeRate {
  id           Int      @id @default(autoincrement())
  fromCurrency String
  toCurrency   String
  rate         Decimal  @db.Decimal(10, 4)
  source       String
  date         DateTime @default(now())
  isActive     Boolean  @default(true)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
  buyRate      Decimal? @db.Decimal(10, 4)
  sellRate     Decimal? @db.Decimal(10, 4)

  @@unique([fromCurrency, toCurrency, date], name: "unique_rate_per_day")
  @@map("exchange_rates")
}

model ExchangeRateMN {
  id         Int      @id @default(autoincrement())
  buyRate    Decimal  @db.Decimal(10, 4)
  sellRate   Decimal  @db.Decimal(10, 4)
  source     String   @default("manual")
  date       DateTime @default(now())
  isActive   Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("exchange_rates_mn")
}

model UtilityRate {
  id                Int      @id @default(autoincrement())
  utilityPercentage Decimal  @db.Decimal(5, 2)
  source            String   @default("manual")
  date              DateTime @default(now())
  isActive          Boolean  @default(true)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  @@map("utility_rates")
}

model ShippingRate {
  id                Int      @id @default(autoincrement())
  domesticRate      Decimal  @db.Decimal(10, 2)
  internationalRate Decimal  @db.Decimal(10, 2)
  weight            Decimal  @db.Decimal(10, 3)
  description       String?  @db.Text
  source            String   @default("manual")
  date              DateTime @default(now())
  isActive          Boolean  @default(true)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  @@map("shipping_rates")
}

model customer {
  id         Int      @id @default(autoincrement())
  name       String
  phone      String?
  created_at DateTime @default(now())
  email      String?
  sale       sale[]
}

model receipt {
  id          Int           @id @default(autoincrement())
  supplierId  Int
  date        DateTime
  notes       String?
  created_at  DateTime      @default(now())
  supplier    supplier      @relation(fields: [supplierId], references: [id], map: "Receipt_supplierId_fkey")
  receiptitem receiptitem[]

  @@index([date], map: "Receipt_date_idx")
  @@index([supplierId, date], map: "Receipt_supplierId_date_idx")
}

model receiptitem {
  id             Int       @id @default(autoincrement())
  receiptId      Int
  medicineId     Int
  qty            Int
  unit_cost      Decimal   @default(0.00) @db.Decimal(10, 2)
  weight_kg      Decimal   @default(0.000) @db.Decimal(10, 3)
  expirationDate DateTime?
  lot            String?   @db.VarChar(100)
  medicines      Medicine  @relation(fields: [medicineId], references: [id], onDelete: Cascade, map: "ReceiptItem_medicineId_fkey")
  receipt        receipt   @relation(fields: [receiptId], references: [id], onDelete: Cascade, map: "ReceiptItem_receiptId_fkey")

  @@index([medicineId], map: "ReceiptItem_medicineId_fkey")
  @@index([receiptId], map: "ReceiptItem_receiptId_fkey")
}

model roles {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?  @db.Text
  startPanel  String?  @default("/dashboard")
  created_at  DateTime @default(now())
  updated_at  DateTime
  permissions Json
  isActive    Boolean  @default(true)
  users       User[]
}

model sale {
  id         Int        @id @default(autoincrement())
  customerId Int
  date       DateTime
  notes      String?
  created_at DateTime   @default(now())
  customer   customer   @relation(fields: [customerId], references: [id], map: "Sale_customerId_fkey")
  saleitem   saleitem[]

  @@index([customerId, date], map: "Sale_customerId_date_idx")
  @@index([date], map: "Sale_date_idx")
}

model saleitem {
  id                   Int       @id @default(autoincrement())
  saleId               Int
  medicineId           Int
  qty                  Int
  costo_unitario_usd   Decimal?  @db.Decimal(10, 2)
  precio_propuesto_usd Decimal?  @db.Decimal(10, 2)
  supplierId           Int?
  medicines            Medicine  @relation(fields: [medicineId], references: [id], onDelete: Cascade, map: "SaleItem_medicineId_fkey")
  sale                 sale      @relation(fields: [saleId], references: [id], map: "SaleItem_saleId_fkey")
  supplier             supplier? @relation(fields: [supplierId], references: [id], map: "SaleItem_supplierId_fkey")

  @@index([medicineId], map: "SaleItem_medicineId_fkey")
  @@index([saleId], map: "SaleItem_saleId_fkey")
  @@index([supplierId], map: "SaleItem_supplierId_fkey")
}

model supplier {
  id             Int             @id @default(autoincrement())
  name           String
  phone          String?
  created_at     DateTime        @default(now())
  medicinePrices MedicinePrice[]
  receipt        receipt[]
  saleitem       saleitem[]
}

enum FormaFarmaceutica {
  comprimidos
  capsulas
  jarabe
  suspension
  inyectables
  unguentos
  gel
  pomadas
  soluciones
  ovulos
  supositorios
  otros
}

enum Concentracion {
  mg
  ml
  ui
  estandar
}

enum Presentacion {
  blister
  tubo
  frasco
  sobres
  ampollas
  otros
}
